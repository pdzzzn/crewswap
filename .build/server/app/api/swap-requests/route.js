"use strict";(()=>{var e={};e.id=254,e.ids=[254],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},2600:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>w,serverHooks:()=>q,staticGenerationAsyncStorage:()=>y});var s={};t.r(s),t.d(s,{GET:()=>p,POST:()=>l,dynamic:()=>c});var n=t(9182),a=t(2007),i=t(6719),u=t(3442),o=t(5970),d=t(1826);let c="force-dynamic";async function p(){try{let e=await (0,d.mk)(),r=await o._.swapRequest.findMany({where:{senderId:e.id},include:{receiver:{select:{id:!0,name:!0,role:!0}},senderDuty:!0,targetDuty:!0},orderBy:{createdAt:"desc"}}),t=await o._.swapRequest.findMany({where:{receiverId:e.id},include:{sender:{select:{id:!0,name:!0,role:!0}},senderDuty:!0,targetDuty:!0},orderBy:{createdAt:"desc"}});return u.NextResponse.json({sentRequests:r,receivedRequests:t})}catch(e){if(console.error("Fetch swap requests error:",e),e instanceof Error&&"Authentication required"===e.message)return u.NextResponse.json({error:"Authentication required"},{status:401});return u.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e){try{let r=await (0,d.mk)(),{senderDutyId:t,targetDutyId:s,receiverId:n,message:a}=await e.json();if(!t||!s||!n)return u.NextResponse.json({error:"Missing required fields"},{status:400});if(!await o._.duty.findFirst({where:{id:t,userId:r.id}}))return u.NextResponse.json({error:"Invalid sender duty"},{status:400});if(!await o._.duty.findFirst({where:{id:s,userId:n}}))return u.NextResponse.json({error:"Invalid target duty"},{status:400});if(await o._.swapRequest.findFirst({where:{senderDutyId:t,targetDutyId:s,status:"PENDING"}}))return u.NextResponse.json({error:"A swap request already exists for these duties"},{status:400});let i=await o._.swapRequest.create({data:{senderId:r.id,receiverId:n,senderDutyId:t,targetDutyId:s,message:a||null}});return await o._.notification.create({data:{userId:n,type:"SWAP_REQUEST_RECEIVED",title:"New Swap Request",message:`${r.name} wants to swap duties with you`,swapRequestId:i.id}}),u.NextResponse.json({message:"Swap request sent successfully",swapRequest:i})}catch(e){if(console.error("Create swap request error:",e),e instanceof Error&&"Authentication required"===e.message)return u.NextResponse.json({error:"Authentication required"},{status:401});return u.NextResponse.json({error:"Internal server error"},{status:500})}}let w=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/swap-requests/route",pathname:"/api/swap-requests",filename:"route",bundlePath:"app/api/swap-requests/route"},resolvedPagePath:"/home/ubuntu/aviation-crew-swap/app/app/api/swap-requests/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:q}=w,m="/api/swap-requests/route";function x(){return(0,i.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:y})}},1826:(e,r,t)=>{t.d(r,{Gv:()=>p,RA:()=>l,c_:()=>c,mk:()=>f,ts:()=>w});var s=t(3390),n=t.n(s),a=t(9165),i=t.n(a),u=t(3378),o=t(5970);let d=process.env.JWT_SECRET||"aviation-crew-swap-secret-key";async function c(e){return n().hash(e,12)}async function p(e,r){return n().compare(e,r)}function l(e){return i().sign(e,d,{expiresIn:"7d"})}async function w(){try{let e=(0,u.cookies)(),r=e.get("auth-token")?.value;if(!r)return null;let t=function(e){try{return i().verify(e,d)}catch{return null}}(r);if(!t)return null;return await o._.user.findUnique({where:{id:t.userId},select:{id:!0,email:!0,name:!0,role:!0}})}catch{return null}}async function f(){let e=await w();if(!e)throw Error("Authentication required");return e}},5970:(e,r,t)=>{t.d(r,{_:()=>n});let s=require("@prisma/client"),n=globalThis.prisma??new s.PrismaClient}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[372,514,971],()=>t(2600));module.exports=s})();