generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String         @id
  email                String         @unique
  name                 String
  role                 UserRole
  createdAt            DateTime       @default(now()) @map("created_at")
  updatedAt            DateTime       @updatedAt @map("updated_at")
  base                 EWLBases       @default(PMI)
  isAdmin              Boolean        @default(false) @map("is_admin")
  duties               Duty[]
  notifications        Notification[]
  receivedSwapRequests SwapRequest[]  @relation("SwapRequestReceiver")
  sentSwapRequests     SwapRequest[]  @relation("SwapRequestSender")

  @@map("users")
}

model Duty {
  id                 String        @id @default(uuid())
  date               DateTime
  userId             String        @map("user_id")
  createdAt          DateTime      @default(now()) @map("created_at")
  updatedAt          DateTime      @updatedAt @map("updated_at")
  pairing            String?
  user               User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  legs               FlightLeg[]
  sentSwapRequests   SwapRequest[] @relation("SwapRequestSenderDuty")
  targetSwapRequests SwapRequest[] @relation("SwapRequestTargetDuty")

  @@map("duties")
}

model FlightLeg {
  id                String   @id @default(uuid())
  dutyId            String   @map("duty_id")
  flightNumber      String   @map("flight_number")
  departureTime     DateTime @map("departure_time")
  arrivalTime       DateTime @map("arrival_time")
  departureLocation String   @map("departure_location")
  arrivalLocation   String   @map("arrival_location")
  isDeadhead        Boolean  @default(false) @map("is_deadhead")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  duty              Duty     @relation(fields: [dutyId], references: [id])

  @@map("flight_legs")
}

model SwapRequest {
  id              String            @id @default(uuid())
  senderId        String            @map("sender_id")
  receiverId      String            @map("receiver_id")
  senderDutyId    String            @map("sender_duty_id")
  targetDutyId    String            @map("target_duty_id")
  status          SwapRequestStatus @default(PENDING)
  message         String?
  responseMessage String?           @map("response_message")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  receiver        User              @relation("SwapRequestReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  senderDuty      Duty              @relation("SwapRequestSenderDuty", fields: [senderDutyId], references: [id], onDelete: Cascade)
  sender          User              @relation("SwapRequestSender", fields: [senderId], references: [id], onDelete: Cascade)
  targetDuty      Duty              @relation("SwapRequestTargetDuty", fields: [targetDutyId], references: [id], onDelete: Cascade)

  @@map("swap_requests")
}

model Notification {
  id            String           @id @default(uuid())
  userId        String           @map("user_id")
  type          NotificationType
  title         String
  message       String
  isRead        Boolean          @default(false) @map("is_read")
  swapRequestId String?          @map("swap_request_id")
  createdAt     DateTime         @default(now()) @map("created_at")
  user          User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

enum UserRole {
  CAPTAIN
  FIRST_OFFICER
  PURSER
  CABIN_ATTENDANT
}

enum SwapRequestStatus {
  PENDING
  APPROVED
  DENIED
  CANCELLED
}

enum NotificationType {
  SWAP_REQUEST_RECEIVED
  SWAP_REQUEST_APPROVED
  SWAP_REQUEST_DENIED
  SWAP_REQUEST_CANCELLED
}

enum EWLBases {
  PMI
  ARN
  PRG
  SZG
  VIE
  WP_PMI
  WP_BCN
  WP_PRG
}
